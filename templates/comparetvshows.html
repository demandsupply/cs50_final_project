{% extends "layout.html" %}

{% block title %}
    AJAX compare shows
{% endblock %}

{% block main %}

<h1>Tv Show Search</h1>
    
    <input type="text" id="searchShowInput" placeholder="Enter a tv show title">
    <button onclick="performShowSearch()">Search</button>

    <div id="searchShowResults"></div>

    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="./../static/main.js"></script>



{% for show in compare %}
    <h4>{{show.show_title}}</h4>
    {{show.episodes_ratings}}
    <form action="/comparetvshows" method="post">
        <input type="hidden" name="remove" value="{{ show.show_title }}">
        <button type="submit">remove {{show.show_title}} </button>
    </form>
{% endfor %}

<div>
    <canvas id="myChart" style="width:100%; max-width:700px;"></canvas>
</div>

<script>

var xyValues = [];
var x;
var y;
var dictList = JSON.parse('{{compare|tojson}}');
console.log(`diclist is ${dictList}`);
var temp = dictList[0].episodes_ratings;
console.log(`temp is ${temp}`);
console.log(`temp is ${temp.length}`);
var listList = [];
var listSeasons = [];
var listEpisodes = [];
var tempList = [];
var xyValuesList = [];
objectCounter = 0;

var listDict = []

// function toNumber(value) {
//     return +value;
// }

for(d = 0; d <dictList.length; d++) {
    tempList[d] = dictList[d].episodes_ratings;
    listList.push(tempList[d]);
}

// console.log(`listlist 2 is ${listList[1]}`);
console.log(`listlist is ${listList}`);

for(d = 0; d <dictList.length; d++) {
    var newDict = {};
    var episodes = 0;
    newDict["title"] = dictList[d].show_title;
    newDict["ratings"] = [];

    stringList = listList[d]; 
    counterParenthesis = 0;

    for(i=0; i<stringList.length; i++) {
        if(stringList[i]==='[') {
            counterParenthesis = counterParenthesis+1;
        } 
    }

    allC = [];
    var stringNumber='';
    listIndex = 0;
    listEpisodesIndex = 0;
    typefo = typeof stringList;

    for(character=0; character<stringList.length; character++) {
    //    console.log(`character is ${stringList[character]}`);
        if(stringList[character]==='[') {
            //console.log(`create a new list of ratings for each episode of the specified season`);
            stringNumber='';
            listEpisodes=[];
        } 

        else if(stringList[character]===']') {
            NumberNumber = Number(stringNumber);
            listEpisodes.push(NumberNumber);
            newDict["ratings"].push(NumberNumber)
            stringNumber='';
            //console.log(`closed the previous list of ratings for each episode of the specified season`);
            listSeasons.push(listEpisodes);
            listIndex = listIndex + 1;
            episodes = episodes + 1;
        } 

        else if(stringList[character]!='[' && stringList[character]!=',' && stringList[character]!=']') {
            stringNumber = stringNumber + stringList[character];
        }

        else if(stringList[character]===',') {
            NumberNumber = Number(stringNumber);
            listEpisodes.push(NumberNumber);
            newDict["ratings"].push(NumberNumber)
            //console.log(`stringNumber type is ${typeof NumberNumber}`);
            stringNumber='';
            //console.log(`stringNumber empty is ${stringNumber}`);

            listEpisodesIndex++;
            episodes = episodes + 1;
        }

        newDict["episodes"] = episodes;

        //console.log(`newdict is ${Object.values(newDict)}`);
        //console.log(`title is ${newDict["title"]}`);
        //console.log(`episodes is ${newDict["episodes"]}`);
        //console.log(`ratings is ${newDict["ratings"]}`);
    }

    listDict.push(newDict)
}

console.log(listDict);

for (var i = 0; i < listDict.length; i++) {
    console.log('listDict is', Object.values(listDict[i].ratings));
    var name = listDict[i].title;
    console.log(name)
    for (var j = 0; j < listDict[i].ratings.length; j++) {
        //console.log('rating is', listDict[i].ratings[j])
    }
}

xyValues2 = [];
xyValues3 = [];

objectCounter2 = 0;
objectCounter3 = 0;

tempList = Object.values(listDict[0].ratings)
console.log("templist is", tempList);

for(s = 0; s < tempList.length; s++) {
    xyValues.push({ x: objectCounter +1, y: tempList[s], z: `E${s}`});
    //console.log("n" + (objectCounter + 1) + "rate" + tempList[s]);
    objectCounter++;
}
tempList2 = Object.values(listDict[1].ratings)
console.log("templist is", tempList2);

for(s = 0; s < tempList2.length; s++) {
    xyValues2.push({ x: objectCounter2 +1, y: tempList2[s], z: `E${s}`});
    //console.log("n" + (objectCounter2 + 1) + "rate" + tempList2[s]);
    objectCounter2++;
}
tempList3 = Object.values(listDict[2].ratings)
console.log("templist is", tempList3);

for(s = 0; s < tempList3.length; s++) {
    xyValues3.push({ x: objectCounter3 +1, y: tempList3[s], z: `E${s}`});
    //console.log("n" + (objectCounter3 + 1) + "rate" + tempList3[s]);
    objectCounter3++;
}

console.log("xyValues is", xyValues);
console.log("xyValues2 is", xyValues2);
console.log("xyValues3 is", xyValues3);
// console.log("xyValues is", xyValues[0].z);
console.log(objectCounter);



new Chart("myChart", {
  type: "scatter",
  data: {
    datasets: [
    {
        label: "Data1",
        pointRadius: 4,
        pointBackgroundColor: "rgb(0,0,255)",
        data: xyValues
    },
    {
        label: "Data2",
        pointRadius: 4,
        pointBackgroundColor: "rgb(0,255,0)",
        data: xyValues2
    },
    {
        label: "Data3",
        pointRadius: 4,
        pointBackgroundColor: "rgb(255,0,0)",
        data: xyValues3
    },

    ]
  },
  options: {
    // events:['click'],
    legend: {display: false},
    scales: {
      xAxes: [{ticks: {min: 0, max:objectCounter}}],
      yAxes: [{ticks: {min: 0, max:10}}],
    },
    tooltips: {
                enabled: true,
                mode: 'single',
                callbacks: {
                    label: function(tooltipItem, xyValues) { 
                        var dataset = xyValues.datasets[tooltipItem.datasetIndex];
                        var point = dataset.data[tooltipItem.index];
                        return ' (episode ' + (point.x) + ')' + ', vote:' + point.y;
                    }
                }
            },
  }
});

</script>


{% endblock %}